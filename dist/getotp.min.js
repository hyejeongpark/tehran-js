"use strict";(function(e){function t(){function t(){var e=new URL(a.script_origin),t=e.origin,i=document.createElement("link");i.setAttribute("rel","stylesheet");var n=t+"/static/css/getotp_modal.min.css";a.settings.dev_mode&&(n=t+"/dist/getotp_modal.min.css"),i.setAttribute("href",n),document.getElementsByTagName("head")[0].appendChild(i);var o=document.createElement("script");o.setAttribute("type","text/javascript");var s=t+"/static/js/getotp_modal.min.js";return a.settings.dev_mode&&(s=t+"/dist/getotp_modal.min.js"),o.setAttribute("src",s),document.body.appendChild(o),o}function i(e){return"compact"===e?"div#"+a.settings.iframe_container_id+" iframe { border: 0; }":"div#"+a.settings.iframe_container_id+" { position: fixed; bottom: 0; width: 100%; background-color: white; } div#"+a.settings.iframe_container_id+" iframe { border: 0; }"}function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"compact",t=document.createElement("style"),n=i(e);t.appendChild(document.createTextNode(n)),document.getElementsByTagName("head")[0].appendChild(t)}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"compact";return e+"pin/?embed_mode="+t}function s(t,i){"function"==typeof e[t]?e[t].call(null,i):console.info("Callback function "+t+"(payload) has not been define")}var r={iframe_container_id:"getotp_iframe_parent",iframe_container_class:"",iframe_id:"getotp_iframe",iframe_class:"",success_callback_function:"otpSuccess",failed_callback_function:"otpFailed",url_storage_key:"getotp_form_url",dev_mode:!1},a={settings:r,trusted_origins:["https://otp.dev"],active_modal:null,embed_type:null,embed_height:null,embed_dom_id:"getotp_modal_embed_body",modal_spinner_id:"getotp_modal_spinner",script_origin:document.currentScript&&document.currentScript.src,init:function(e){for(var t in console.log("options",e),e)this.settings.hasOwnProperty(t)&&(this.settings[t]=e[t],"iframe_container_id"===t&&n());console.log("this",this)},getotpServerMessage:function(t){console.log("event",t);var i=e.location.origin;if(t.origin==i||a.trusted_origins.includes(t.origin)){var n=t.data;"function"==typeof a[n.func]&&a[n.func].call(null,n.message)}else console.error("Server callback failed because event origin "+t.origin+" is not define inside trusted_origins")},iframeHeightCallback:function(e){var t=e.embed_height;a.updateIframeHeight(t)},keyPressCallback:function(e){var t=e.keycode;a.handleKeypressCallback(t)},otpClientCallback:function(t){var i=t.otp_id,n=t.status,o=t.redirect_url,s={otp_id:i,status:n,redirect_url:o};if("success"===n){var r=new CustomEvent("onOtpSucces",{detail:s});e.dispatchEvent(r)}else if("fail"===n){var a=new CustomEvent("onOtpFailed",{detail:s});e.dispatchEvent(a)}},embedOtpForm:function(e,t){s("otpBeforeLoad",{});var i=document.createElement("div");i.setAttribute("id",this.settings.iframe_container_id),i.setAttribute("class",this.settings.iframe_container_class);var n=document.createElement("iframe");n.setAttribute("id",this.settings.iframe_id),n.setAttribute("class",this.settings.iframe_class),i.appendChild(n),console.log("iframe.src",e),n.src=e,n.width="100%",console.log("embed_container",t),t.appendChild(i);var o=this;n.addEventListener("load",function(){var e=document.getElementById(o.modal_spinner_id);e&&e.parentNode.removeChild(e)})},initEmbed:function(e,t){var i="compact";this.embed_type="embed",this.embedOtpForm(e,t),n(i)},showEmbed:function(e,t){var i="compact",n=o(e,i);return sessionStorage.setItem(this.settings.url_storage_key,n),this.initEmbed(n,t),!0},reloadEmbed:function(e){var t=sessionStorage.getItem(this.settings.url_storage_key);t?this.initEmbed(t,e):console.error("No previous otp form url define in session storage with key "+this.settings.url_storage_key)},initModal:function(e){function i(){var t=new tingle.modal({footer:!1,closeMethods:["overlay","button","escape"],closeLabel:"Close",onOpen:function(){s("otpModalOpen",{})},onClose:function(){t.destroy(),s("otpModalClose",{})},beforeClose:function(){return!0}});a.active_modal=t;var i=a.embed_dom_id,o=a.modal_spinner_id,d='<svg width="38" height="38" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" stroke="#000"> <g fill="none" fill-rule="evenodd"> <g transform="translate(1 1)" stroke-width="2"> <circle stroke-opacity=".5" cx="18" cy="18" r="18" /> <path d="M36 18c0-9.94-8.06-18-18-18"> <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite" /> </path> </g> </g> </svg>',c='<div id="'+o+'" style="display: flex; align-items: center; justify-content: center; height: 100%;">'+d+"</div>";t.setContent('<div id="'+i+'">'+c+"</div>");var l=document.getElementById(i);a.embedOtpForm(e,l),n(r),t.open()}if("undefined"!=typeof tingle)i();else{var o=t();o.addEventListener("load",function(){i()})}var r="compact";this.embed_type="modal"},showModal:function(e){var t="compact",i=o(e,t);sessionStorage.setItem(this.settings.url_storage_key,i),this.initModal(i)},hideModal:function(e){this.active_modal&&this.active_modal.close()},reloadModal:function(){var e=sessionStorage.getItem(this.settings.url_storage_key);if(e)return this.initModal(e),!0;console.error("No previous otp form url define in session storage with key "+this.settings.url_storage_key)},initSticky:function(e){var t="wide";this.embed_type="sticky";var i=document.body;this.embedOtpForm(e,i),n(t)},showSticky:function(e){var t="wide",i=o(e,t);return sessionStorage.setItem(this.settings.url_storage_key,i),this.initSticky(i),!0},connect:function(e,t){var i=e.success_redirect_url,n=e.fail_redirect_url,o=e.user_email,s=t.api_url,r=t.api_key,a=t.api_token,d={callback_url:i,success_redirect_url:i,fail_redirect_url:n,channel:"email",email:o,embed:"compact"};s+="api/verify/";var c=btoa(r+":"+a),l={method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Basic "+c},body:JSON.stringify(d)},u=fetch(s,l).then(function(e){return e.json()});return u},reloadSticky:function(){var e=sessionStorage.getItem(this.settings.url_storage_key);if(e)return this.initSticky(e),!0;console.error("No previous otp form url define in session storage with key "+this.settings.url_storage_key)},handleKeypressCallback:function(e){27==e&&("modal"==this.embed_type&&this.hideModal(),s("keypressCallback",{keycode:e}))},updateIframeHeight:function(e){var t=e+"px",i=document.getElementById("getotp_iframe");i.style.height=e+"px",console.log("update iframe height",t),this.embed_height=t,s("otpAfterLoad",{})},getEmbedHeight:function(){return this.embed_height},onSuccess:function(t){e.addEventListener("onOtpSucces",function(e){var i=e.detail;t(i)})},onFailed:function(t){e.addEventListener("onOtpFailed",function(e){var i=e.detail;t(i)})},addOrigin:function(e){return e=e.replace(/\/$/,""),this.trusted_origins.push(e),this.trusted_origins},clearSession:function(){sessionStorage.removeItem(this.settings.url_storage_key)}};return a}void 0===e.getotp&&(e.getotp=t()),e.addEventListener?e.addEventListener("message",e.getotp.getotpServerMessage,!1):e.attachEvent&&e.attachEvent("onmessage",e.getotp.getotpServerMessage,!1)})(window);