"use strict";(function(e){function t(){function t(e){return"compact"===e?"div#"+r.settings.iframe_container_id+" iframe { border: 0; }":"div#"+r.settings.iframe_container_id+" { position: fixed; bottom: 0; width: 100%; background-color: white; } div#"+r.settings.iframe_container_id+" iframe { border: 0; }"}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"compact",i=document.createElement("style"),o=t(e);i.appendChild(document.createTextNode(o)),document.getElementsByTagName("head")[0].appendChild(i)}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"compact";return e+"pin/?embed_mode="+t}function n(t,i){"function"==typeof e[t]?e[t].call(null,i):console.info("Callback function "+t+"(payload) has not been define")}var s={iframe_container_id:"getotp_iframe_parent",iframe_container_class:"",iframe_id:"getotp_iframe",iframe_class:"",success_callback_function:"otpSuccess",failed_callback_function:"otpFailed",url_storage_key:"getotp_form_url"},r={settings:s,trusted_origins:["https://otp.dev"],active_modal:null,embed_type:null,embed_height:null,init:function(e){for(key in console.log("options",e),e)this.settings.hasOwnProperty(key)&&(this.settings[key]=e[key],"iframe_container_id"===key&&i());console.log("this",this)},getotpServerMessage:function(t){console.log("event",t);var i=e.location.origin;if(t.origin==i||r.trusted_origins.includes(t.origin)){var o=t.data;"function"==typeof r[o.func]&&r[o.func].call(null,o.message)}else console.error("Server callback failed because event origin "+t.origin+" is not define inside trusted_origins")},iframeHeightCallback:function(e){var t=e.embed_height;r.updateIframeHeight(t)},keyPressCallback:function(e){var t=e.keycode;r.handleKeypressCallback(t)},otpClientCallback:function(t){var i=t.otp_id,o=t.status,n=t.redirect_url,s={otp_id:i,status:o,redirect_url:n};"success"===o?"function"==typeof e[r.settings.success_callback_function]?e[r.settings.success_callback_function].call(null,s):console.error("To handle OTP success callback, please define function "+r.settings.success_callback_function+"(payload)"):"fail"===o&&("function"==typeof e[r.settings.failed_callback_function]?e[r.settings.failed_callback_function].call(null,s):console.error("To handle OTP error callback, please define function "+r.settings.failed_callback_function+"(payload)"))},embedOtpForm:function(e,t){n("otpBeforeLoad",{});var i=document.createElement("div");i.setAttribute("id",this.settings.iframe_container_id),i.setAttribute("class",this.settings.iframe_container_class);var o=document.createElement("iframe");o.setAttribute("id",this.settings.iframe_id),o.setAttribute("class",this.settings.iframe_class),i.appendChild(o),console.log("iframe.src",e),o.src=e,o.width="100%",console.log("embed_container",t),t.appendChild(i)},initOtpForm:function(e,t){var o="compact";this.embed_type="embed",this.embedOtpForm(e,t),i(o)},showOtpForm:function(e,t){var i="compact",n=o(e,i);return sessionStorage.setItem(this.settings.url_storage_key,n),this.initOtpForm(n,t),!0},reloadOtpForm:function(e){var t=sessionStorage.getItem(this.settings.url_storage_key);t?this.initOtpForm(t,e):console.error("No previous otp form url define in session storage with key "+this.settings.url_storage_key)},initModalForm:function(e){var t="compact";this.embed_type="modal";var o=new tingle.modal({footer:!1,closeMethods:["overlay","button","escape"],closeLabel:"Close",onOpen:function(){n("otpModalOpen",{})},onClose:function(){o.destroy(),n("otpModalClose",{})},beforeClose:function(){return!0}});this.active_modal=o;var s="getotp_modal_embed_body";o.setContent('<div id="'+s+'"></div>');var r=document.getElementById(s);this.embedOtpForm(e,r),i(t),o.open()},showModalForm:function(e){var t="compact",i=o(e,t);sessionStorage.setItem(this.settings.url_storage_key,i),this.initModalForm(i)},hideModalForm:function(e){this.active_modal&&this.active_modal.close()},reloadModalForm:function(){var e=sessionStorage.getItem(this.settings.url_storage_key);if(e)return this.initModalForm(e),!0;console.error("No previous otp form url define in session storage with key "+this.settings.url_storage_key)},initStickyForm:function(e){var t="wide";this.embed_type="sticky";var o=document.body;this.embedOtpForm(e,o),i(t)},showStickyForm:function(e){var t="wide",i=o(e,t);return sessionStorage.setItem(this.settings.url_storage_key,i),this.initStickyForm(i),!0},reloadStickyForm:function(){var e=sessionStorage.getItem(this.settings.url_storage_key);if(e)return this.initStickyForm(e),!0;console.error("No previous otp form url define in session storage with key "+this.settings.url_storage_key)},handleKeypressCallback:function(e){27==e&&("modal"==this.embed_type&&this.hideModalForm(),n("keypressCallback",{keycode:e}))},updateIframeHeight:function(e){var t=e+"px",i=document.getElementById("getotp_iframe");i.style.height=e+"px",console.log("update iframe height",t),this.embed_height=t,n("otpAfterLoad",{})},getEmbedHeight:function(){return this.embed_height},addOrigin:function(e){return e=e.replace(/\/$/,""),this.trusted_origins.push(e),this.trusted_origins},clearSession:function(){sessionStorage.removeItem(this.settings.url_storage_key)}};return r}void 0===e.getotp&&(e.getotp=t()),e.addEventListener?e.addEventListener("message",e.getotp.getotpServerMessage,!1):e.attachEvent&&e.attachEvent("onmessage",e.getotp.getotpServerMessage,!1)})(window);