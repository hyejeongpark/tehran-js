"use strict";(function(e){function t(){function t(){var e=new URL(l.script_origin),t=e.origin,i=document.createElement("link");i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css");var n=t+"/static/css/getotp_modal.min.css";l.settings.dev_mode&&(n=t+"/dist/getotp_modal.min.css"),i.setAttribute("href",n),document.getElementsByTagName("head")[0].appendChild(i);var o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("async",!0);var s=t+"/static/js/getotp_modal.min.js";return l.settings.dev_mode&&(s=t+"/dist/getotp_modal.min.js"),o.setAttribute("src",s),document.body.appendChild(o),o}function i(e){return"compact"===e?"div#"+l.settings.iframe_container_id+" iframe { border: 0; }":"div#"+l.settings.iframe_container_id+" { position: fixed; bottom: 0; width: 100%; background-color: white; } div#"+l.settings.iframe_container_id+" iframe { border: 0; }"}function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"compact",t=document.createElement("style"),n=i(e);t.appendChild(document.createTextNode(n)),document.getElementsByTagName("head")[0].appendChild(t)}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"compact";return e+"pin/?embed_mode="+t}function s(t,i){var n=new CustomEvent(t,{detail:i});e.dispatchEvent(n)}function r(e){var t=e+"px",i=document.getElementById("getotp_iframe");i.style.height=e+"px",console.log("update iframe height",t),l.embed_height=t,s("onOtpAfterLoad",{})}function a(e,t){var i=new tingle.modal({footer:!1,closeMethods:["overlay","button","escape"],closeLabel:"Close",onOpen:function(){s("onOpenModal",{})},onClose:function(){i.destroy(),s("onCloseModal",{})},beforeClose:function(){return!0}});l.active_modal=i;var o=l.embed_dom_id,r=l.modal_spinner_id,a='<svg width="38" height="38" viewBox="0 0 38 38" xmlns="http://www.w3.org/2000/svg" stroke="#000"> <g fill="none" fill-rule="evenodd"> <g transform="translate(1 1)" stroke-width="2"> <circle stroke-opacity=".5" cx="18" cy="18" r="18" /> <path d="M36 18c0-9.94-8.06-18-18-18"> <animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="1s" repeatCount="indefinite" /> </path> </g> </g> </svg>',d='<div id="'+r+'" style="display: flex; align-items: center; justify-content: center; height: 100%;">'+a+"</div>";i.setContent('<div id="'+o+'">'+d+"</div>");var c=document.getElementById(o);l.embedOtpForm(e,c),n(t),i.open()}function d(e){27==e&&"modal"==l.embed_type&&l.closeModal(),s("onOtpKeypress",{keycode:e})}var c={ui_mode:"modal",iframe_container_id:"getotp_iframe_parent",iframe_container_class:"",iframe_id:"getotp_iframe",iframe_class:"",success_callback_function:"otpSuccess",failed_callback_function:"otpFailed",url_storage_key:"getotp_form_url",dev_mode:!1},l={settings:c,trusted_origins:["https://otp.dev"],active_modal:null,embed_type:null,embed_height:null,embed_dom_id:"getotp_modal_embed_body",modal_spinner_id:"getotp_modal_spinner",script_origin:document.currentScript&&document.currentScript.src,init:function(e){for(var t in console.log("options",e),e)this.settings.hasOwnProperty(t)&&(this.settings[t]=e[t],"iframe_container_id"===t&&n());this.settings.ui_mode},getotpServerMessage:function(t){console.log("event",t);var i=e.location.origin;if(t.origin==i||l.trusted_origins.includes(t.origin)){var n=t.data;"function"==typeof l[n.func]&&l[n.func].call(null,n.message)}else console.error("Server callback failed because event origin "+t.origin+" is not define inside trusted_origins")},iframeHeightCallback:function(e){var t=e.embed_height;r(t)},keyPressCallback:function(e){var t=e.keycode;d(t)},otpClientCallback:function(e){var t=e.otp_id,i=e.status,n=e.redirect_url,o={otp_id:t,status:i,redirect_url:n};"success"===i?s("onOtpSucces",o):"fail"===i&&s("onOtpFailed",o)},embedOtpForm:function(e,t){s("onOtpBeforeLoad",{});var i=document.createElement("div");i.setAttribute("id",this.settings.iframe_container_id),i.setAttribute("class",this.settings.iframe_container_class);var n=document.createElement("iframe");n.setAttribute("id",this.settings.iframe_id),n.setAttribute("class",this.settings.iframe_class),i.appendChild(n),console.log("iframe.src",e),n.src=e,n.width="100%",console.log("embed_container",t),t.appendChild(i);var o=this;n.addEventListener("load",function(){var e=document.getElementById(o.modal_spinner_id);e&&e.parentNode.removeChild(e)})},initEmbed:function(e,t){var i="compact";this.embed_type="embed",this.embedOtpForm(e,t),n(i)},showEmbed:function(e,t){var i="compact",n=o(e,i);return sessionStorage.setItem(this.settings.url_storage_key,n),this.initEmbed(n,t),!0},reloadEmbed:function(e){var t=sessionStorage.getItem(this.settings.url_storage_key);t?this.initEmbed(t,e):console.error("No previous otp form url define in session storage with key "+this.settings.url_storage_key)},initModal:function(e){var i="compact";if(this.embed_type="modal","undefined"!=typeof tingle)a(e,i);else{var n=t();n.addEventListener("load",function(){a(e,i)})}},showModal:function(e){var t="compact",i=o(e,t);sessionStorage.setItem(this.settings.url_storage_key,i),this.initModal(i)},closeModal:function(e){this.active_modal&&this.active_modal.close()},reloadModal:function(){var e=sessionStorage.getItem(this.settings.url_storage_key);if(e)return this.initModal(e),!0;console.error("No previous otp form url define in session storage with key "+this.settings.url_storage_key)},initSticky:function(e){var t="wide";this.embed_type="sticky";var i=document.body;this.embedOtpForm(e,i),n(t)},showSticky:function(e){var t="wide",i=o(e,t);return sessionStorage.setItem(this.settings.url_storage_key,i),this.initSticky(i),!0},reloadSticky:function(){var e=sessionStorage.getItem(this.settings.url_storage_key);if(e)return this.initSticky(e),!0;console.error("No previous otp form url define in session storage with key "+this.settings.url_storage_key)},connect:function(e,t){var i=e.success_redirect_url,n=e.fail_redirect_url,o=e.user_email,s=t.api_url,r=t.api_key,a=t.api_token,d={callback_url:i,success_redirect_url:i,fail_redirect_url:n,channel:"email",email:o,embed:"compact"};s+="api/verify/";var c=btoa(r+":"+a),l={method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Authorization:"Basic "+c},body:JSON.stringify(d)},u=fetch(s,l).then(function(e){return e.json()});return u},getEmbedHeight:function(){return this.embed_height},onOpenModal:function(t){e.addEventListener("onOpenModal",function(e){var i=e.detail;t(i)})},onCloseModal:function(t){e.addEventListener("onCloseModal",function(e){var i=e.detail;t(i)})},onSuccess:function(t){e.addEventListener("onOtpSucces",function(e){var i=e.detail;t(i)})},onFailed:function(t){e.addEventListener("onOtpFailed",function(e){var i=e.detail;t(i)})},addOrigin:function(e){return e=e.replace(/\/$/,""),this.trusted_origins.push(e),this.trusted_origins},clearSession:function(){sessionStorage.removeItem(this.settings.url_storage_key)}};return l}void 0===e.getotp&&(e.getotp=t()),e.addEventListener?e.addEventListener("message",e.getotp.getotpServerMessage,!1):e.attachEvent&&e.attachEvent("onmessage",e.getotp.getotpServerMessage,!1)})(window);