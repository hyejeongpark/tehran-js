"use strict";(function(e){function t(){function t(){return"div#"+o.settings.iframe_container_id+" { position: fixed; bottom: 0; width: 100%; background-color: white; } div#"+o.settings.iframe_container_id+" iframe { border: 0; }"}function i(){var e=t();o.settings.css_rules=e}function s(e){return e+"pin/?embed_mode="+o.settings.embed_mode}var n={embed_mode:"compact",iframe_container_id:"getotp_iframe_parent",iframe_container_class:"",iframe_id:"getotp_iframe",iframe_class:"",success_callback_function:"otpSuccess",failed_callback_function:"otpFailed",url_storage_key:"getotp_form_url"},o={settings:n,trusted_origins:["https://otp.dev"]};return i(),o.init=function(e){for(key in console.log("options",e),e)this.settings.hasOwnProperty(key)&&(this.settings[key]=e[key],"iframe_container_id"===key&&i());console.log("this",this)},o.getotpServerMessage=function(t){console.log("event",t);var i=e.location.origin;if(t.origin==i||o.trusted_origins.includes(t.origin)){var s=t.data;"function"==typeof o[s.func]&&o[s.func].call(null,s.message)}else console.error("Server callback failed because event origin "+t.origin+" is not define inside trusted_origins")},o.iframeHeightCallback=function(e){var t=e.embed_height;o.updateIframeHeight(t)},o.otpClientCallback=function(t){var i=t.otp_id,s=t.status,n=t.redirect_url,r={otp_id:i,status:s,redirect_url:n};"success"===s?"function"==typeof e[o.settings.success_callback_function]?e[o.settings.success_callback_function].call(null,r):console.error("To handle OTP success callback, please define function "+o.settings.success_callback_function+"(payload)"):"fail"===s&&("function"==typeof e[o.settings.failed_callback_function]?e[o.settings.failed_callback_function].call(null,r):console.error("To handle OTP error callback, please define function "+o.settings.failed_callback_function+"(payload)"))},o.embedOtpForm=function(e,t){var i=document.createElement("div");i.setAttribute("id",this.settings.iframe_container_id),i.setAttribute("class",this.settings.iframe_container_class);var s=document.createElement("iframe");if(s.setAttribute("id",this.settings.iframe_id),s.setAttribute("class",this.settings.iframe_class),i.appendChild(s),console.log("iframe.src",e),s.src=e,s.width="100%",t)t.appendChild(i);else{document.body.appendChild(i);var n=document.createElement("style");n.appendChild(document.createTextNode(this.settings.css_rules)),document.getElementsByTagName("head")[0].appendChild(n)}},o.showOtpForm=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=s(e);return console.log("embed_url",i),sessionStorage.setItem(this.settings.url_storage_key,i),this.embedOtpForm(i,t),!0},o.showModalForm=function(e){s(e);console.log("modal under dev")},o.updateIframeHeight=function(e){console.log("update iframe height",e),this.embed_height=e;var t=document.getElementById("getotp_iframe");t.style.height=e+"px"},o.reloadOtpForm=function(){var e=sessionStorage.getItem(this.settings.url_storage_key);e?this.embedOtpForm(e):console.error("No previous otp form url define in session storage with key "+this.settings.url_storage_key)},o.addOrigin=function(e){return e=e.replace(/\/$/,""),this.trusted_origins.push(e),this.trusted_origins},o.clearSession=function(){sessionStorage.removeItem(this.settings.url_storage_key)},o}void 0===e.getotp&&(e.getotp=t()),e.addEventListener?e.addEventListener("message",e.getotp.getotpServerMessage,!1):e.attachEvent&&e.attachEvent("onmessage",e.getotp.getotpServerMessage,!1)})(window);